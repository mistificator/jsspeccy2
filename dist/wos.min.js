function WoS(){var t={cors_proxy:"https://non-cors.herokuapp.com/",wos_base:"https://www.worldofspectrum.org",wos_search:"/infoseekid.cgi%3Fid=",wos_index:"/games/"},e=function(t){return new Promise((e,o)=>{const n=new XMLHttpRequest;n.open("GET",t),n.onload=function(){200==n.status?e(n.responseText):o(n.responseStatus)},n.onerror=function(){o(n.responseStatus)},n.send()})};return t.getIndex=async function(o){"#"==o&&(o="1");var n=await e(t.cors_proxy+t.wos_base+t.wos_index+o.toLowerCase()+".html"),r=$.parseHTML(n),a=[];return $("pre",r).each((function(e,o){for(var n of $("a",o))a.push({title:$(n).text(),catalogue_url:t.cors_proxy+t.wos_base+$(n).attr("href").replace("?","%3F")})})),new Promise(t=>{t(a)})},t.getLinks=async function(o){var n=await e(o),r=$.parseHTML(n),a=[];return $("table",r).each((function(e,o){var n=$("tr:contains('Filename')",o);if(n.length){var r=$("td:contains('Filename')",n).index();for(var s of n.siblings()){var i=$("a",$("td:eq("+r+")",s)).attr("href");if(i){var p=i.split("."),c=p.pop().toUpperCase();"ZIP"==c&&(c=p.pop().toUpperCase()),"TZX"!=c&&"TAP"!=c&&"Z80"!=c&&"SNA"!=c||a.push(t.cors_proxy+t.wos_base+i)}}return!1}})),new Promise(t=>{t(a)})},t.init=function(e,o,n){$(e).empty(),$(e).append($("<option></option>").text("#"));for(var r="A".charCodeAt(0);r<="Z".charCodeAt(0);r++)$(e).append($("<option></option>").text(String.fromCharCode(r)));$(e).change((function(){$(o).empty(),t.getIndex($(e+" option:selected").html()).then((function(t){for(var e of t){var n=$("<option></option>");n.text(e.title),n.attr("href",e.catalogue_url),$(o).append(n)}$(o).trigger("change")}))})),$(o).change((function(){$(n).empty(),t.getLinks($(o+" option:selected").attr("href")).then((function(t){for(var e=0;e<t.length;e++){var o=$("<option></option>");o.text((e+1).toString()+". "+t[e].slice(t[e].lastIndexOf("/")+1)),o.attr("href",t[e]),$(n).append(o)}}))})),$(e).trigger("change")},t}
