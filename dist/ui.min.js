var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");
var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,g){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,g):$jscomp.polyfillUnisolated(a,b,c,g))};
$jscomp.polyfillUnisolated=function(a,b,c,g){c=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var d=a[g];d in c||(c[d]={});c=c[d]}a=a[a.length-1];g=c[a];b=b(g);b!=g&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,g){var d=a.split(".");a=1===d.length;g=d[0];g=!a&&g in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var k=0;k<d.length-1;k++){var l=d[k];l in g||(g[l]={});g=g[l]}d=d[d.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?g[d]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:b}):b!==c&&($jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+d,d=$jscomp.propertyToPolyfillSymbol[d],
$jscomp.defineProperty(g,d,{configurable:!0,writable:!0,value:b})))};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof d?a:new d(function(b,l){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var g=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){g(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(q){this.asyncThrow_(q)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(m){b.reject(m)}};d.prototype.createResolveAndReject_=function(){function a(a){return function(h){c||(c=!0,a.call(b,h))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(m){this.reject_(m);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)k.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var k=new b;d.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};d.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(q){c.reject(q)}};d.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{e(a(b))}catch(x){h(x)}}:b}var e,h,f=new d(function(a,b){e=a;h=b});this.callWhenSettled_(c(a,e),c(b,h));return f};
d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,b){function c(){switch(e.state_){case 1:a(e.result_);break;case 2:b(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?k.asyncExecute(c):this.onSettledCallbacks_.push(c)};d.resolve=c;d.reject=function(a){return new d(function(b,c){c(a)})};d.race=function(a){return new d(function(b,d){for(var e=$jscomp.makeIterator(a),h=e.next();!h.done;h=e.next())c(h.value).callWhenSettled_(b,
d)})};d.all=function(a){var b=$jscomp.makeIterator(a),l=b.next();return l.done?c([]):new d(function(a,h){function f(b){return function(f){e[b]=f;d--;0==d&&a(e)}}var e=[],d=0;do e.push(void 0),d++,c(l.value).callWhenSettled_(f(e.length-1),h),l=b.next();while(!l.done)})};return d},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var g=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(g);if(!g.done)return this.context_.stop_(),g;var d=g.value}catch(k){return this.context_.yieldAllIterator_=null,this.context_.throw_(k),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,d);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(g,d){function k(a){a.done?g(a.value):Promise.resolve(a.value).then(b,c).then(k,d)}k(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,g={next:function(){if(c<a.length){var d=c++;return{value:b(d,a[d]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var d=b.length;c=c||0;for(0>c&&(c=Math.max(c+d,0));c<d;c++){var k=b[c];if(k===a||Object.is(k,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var g=a.length,d=0;d<g;d++){var k=a[d];if(b.call(c,k,d,a))return{i:d,v:k}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
function WoSCat(a){var b={};b.cors_proxy=a||"https://non-cors.herokuapp.com/";b.wos_base="https://www.worldofspectrum.org";b.wos_csv="/software/software_export?";b.wos_index="/archive/software/games/";b.wos_storage="WoS_CSV";var c=function(a){return new Promise(function(b,c){var e=new XMLHttpRequest;e.open("GET",a);e.setRequestHeader("X-Requested-With","XMLHttpRequest");e.onload=function(){200==e.status?b(e.responseText):c(e.responseStatus)};e.onerror=function(){c(e.responseStatus)};e.send()})},g=
JSON.parse(localStorage.getItem(b.wos_storage));b.getCSV=function(){var a,d,e,m,q,h,f,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){if(1==l.nextAddress)return l.yield(c(b.cors_proxy+b.wos_base+b.wos_csv),2);a=l.yieldResult;d={};e=0;e=m=a.indexOf("\n",e+1);for(m=a.indexOf("\n",e+1);0<m;)q=a.substring(e+1,m).trim(),h=q.split(",",4),h[2]&&h[3]&&(f=h[2].replace(/['"]+/g,""),f=f.replace(/^./,f.charAt(0).toUpperCase()),d['"'+f+'"']=h[3]),e=m,m=a.indexOf("\n",e+1);g={};Object.keys(d).sort().forEach(function(a){g[a]=
d[a]});return l.return(new Promise(function(a){a(g)}))})};b.getIndex=function(a){var c,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){c=[];e=0;Object.keys(g).forEach(function(d){d.charAt(1).toUpperCase()==a&&c.push({title:(++e).toString()+"."+d.replace(/['"]+/g,""),catalogue_url:b.cors_proxy+b.wos_base+b.wos_index+g[d]})});return d.return(new Promise(function(a){a(c)}))})};b.getLinks=function(a){var d,e,k,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==h.nextAddress)return h.yield(c(a),
2);d=h.yieldResult;e=$.parseHTML(d);k=[];g=$("h3:hidden",e).first().siblings("table").first();$("tr",g).each(function(a,h){if(0==a)return!0;a=$("a",$("td:eq(1)",h)).attr("href");if(!a)return!0;h=a.split(".");var f=h.pop().toUpperCase();"ZIP"==f&&(f=h.pop().toUpperCase());if("TZX"!=f&&"TAP"!=f&&"Z80"!=f&&"SNA"!=f)return!0;"TAP"==f?k.unshift(b.cors_proxy+a):k.push(b.cors_proxy+a)});return h.return(new Promise(function(a){a(k)}))})};var d=!1;b.init=function(a,c,e,m){var k=$(a+" option").length;$(a).append($("<option></option>").text("WoS - WorldOfSpectrum.org full catalogue"));
$(a).change(function(){d=!1;switch($(a+" option:selected").index()-k){case 0:d=!0;$(c).empty();for(var h=65;90>=h;h++)$(c).append($("<option></option>").text(String.fromCharCode(h)));for(h=48;57>=h;h++)$(c).append($("<option></option>").text(String.fromCharCode(h)));var f=!g;b.getCSV().then(function(a){a&&(localStorage.setItem(b.wos_storage,JSON.stringify(a)),f&&(g=a,$(c).trigger("change")))});f||$(c).trigger("change")}});$(c).change(function(){d&&($(e).empty(),b.getIndex($(c+" option:selected").html()).then(function(a){a=
$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=$("<option></option>");c.text(b.title);c.attr("href",b.catalogue_url);$(e).append(c)}$(e).trigger("change")}))});$(e).change(function(){d&&($(m).empty(),b.getLinks($(e+" option:selected").attr("href")).then(function(a){for(var b=0;b<a.length;b++){var c=$("<option></option>");c.text((b+1).toString()+"."+a[b].slice(a[b].lastIndexOf("/")+1));c.attr("href",a[b]);$(m).append(c)}$(m).trigger("change")}))});0==k&&$(a).trigger("change")};
return b};function ZxCzCat(a){var b={},c=function(a){return a.split("?").join("%3F").split("&").join("%26")};b.cors_proxy=a||"https://non-cors.herokuapp.com/";b.zxcz_base="https://www.zx-spectrum.cz";b.zxcz_index=c("/index.php?cat1=3&cat2=3&games_page=");b.zxcz_download="/data/games/files/";var g=function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.onload=function(){200==d.status?b(d.responseText):c(d.responseStatus)};
d.onerror=function(){c(d.responseStatus)};d.send()})};b.getIndex=function(){var a,d,e,m,q,h,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==k.nextAddress)return a=b.cors_proxy+b.zxcz_base+b.zxcz_index+"1",k.yield(g(a),2);d=k.yieldResult;e=$.parseHTML(d);m=[];m.push({page:"1",catalogue_url:a});q=$jscomp.makeIterator($("a",$(".paging",e).first()));for(h=q.next();!h.done;h=q.next())f=h.value,m.push({page:$(f).text().trim(),catalogue_url:b.cors_proxy+b.zxcz_base+"/"+c($(f).attr("href"))});
return k.return(new Promise(function(a){a(m)}))})};b.getLinks=function(a){var c,d,k;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==e.nextAddress)return e.yield(g(a),2);c=e.yieldResult;d=$.parseHTML(c);k=[];$("tr",$("table.listbox",d)).each(function(a,c){0<a&&(a=$("a",$("td:eq(0)",c)).text().replace(/\s\(\d+\)$/,""),c=$("a:first",$("td:eq(6)",c)).attr("href"),a&&c&&(c=b.cors_proxy+b.zxcz_base+b.zxcz_download+c.slice(c.lastIndexOf("=")+1),k.push({title:a,tape_url:c})))});return e.return(new Promise(function(a){a(k)}))})};
var d=!1;b.init=function(a,c,e,g){var k=$(a+" option").length;$(a).append($("<option></option>").text("ZXCZ - ZX-Spectrum.CZ full catalogue"));$(a).change(function(){d=!1;switch($(a+" option:selected").index()-k){case 0:d=!0,$(c).empty(),b.getIndex().then(function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var d=$("<option></option>");d.text(b.page);d.attr("href",b.catalogue_url);$(c).append(d)}$(c).trigger("change")})}});$(c).change(function(){d&&($(e).empty(),
b.getLinks($(c+" option:selected").attr("href")).then(function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=$("<option></option>");c.text(b.title);c.attr("href",b.tape_url);$(e).append(c)}$(e).trigger("change")}))});$(e).change(function(){if(d){$(g).empty();var a=$(e+" option:selected").attr("href"),b=$("<option></option>");b.text(a.slice(a.lastIndexOf("/")+1));b.attr("href",a);$(g).append(b);$(g).trigger("change")}});0==k&&$(a).trigger("change")};return b};function Rgb2019Cat(a){var b={};b.cors_proxy=a||"https://non-cors.herokuapp.com/";b.rgb2019_base="https://rgb.yandex/";var c=function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.onload=function(){200==d.status?b(d.responseText):c(d.responseStatus)};d.onerror=function(){c(d.responseStatus)};d.send()})};b.getLinks=function(){var a,g,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return d.yield(c(b.cors_proxy+
b.rgb2019_base),2);a=d.yieldResult;g=$.parseHTML(a);l=[];$("div.game__card",g).each(function(a,c){a=a+1+"."+$("h4",c).text().trim();c=$("a:first",c).attr("href");a&&c&&(c=b.cors_proxy+b.rgb2019_base+c,l.push({title:a,tape_url:c}))});return d.return(new Promise(function(a){a(l)}))})};var g=!1;b.init=function(a,c,l,e){var d=$(a+" option").length;$(a).append($("<option></option>").text("RGB - Yandex Retro Games Battle 2019"));$(a).change(function(){g=!1;switch($(a+" option:selected").index()-d){case 0:g=
!0;$(c).empty();var e=$("<option></option>");e.text("-");$(c).append(e);$(l).empty();b.getLinks().then(function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=$("<option></option>");c.text(b.title);c.attr("href",b.tape_url);$(l).append(c)}$(l).trigger("change")})}});$(l).change(function(){if(g){$(e).empty();var a=$(l+" option:selected").attr("href"),b=$("<option></option>");b.text(a.slice(a.lastIndexOf("/")+1));b.attr("href",a);$(e).append(b);$(e).trigger("change")}});
0==d&&$(a).trigger("change")};return b};function ArchCat(a){var b={};b.cors_proxy=a||"https://non-cors.herokuapp.com/";b.arch_base="https://archive.org";b.arch_search="/advancedsearch.php?fl%5B%5D=identifier&fl%5B%5D=title&sort%5B%5D=titleSorter+asc&rows=100000&page=1&output=json&q=mediatype%3Asoftware+identifier%3Azx_";b.arch_download="/download/";var c=function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.onload=function(){200==d.status?b(d.responseText):
c(d.responseStatus)};d.onerror=function(){c(d.responseStatus)};d.send()})};b.getIndex=function(a){var d,g,e,m,q,h,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==k.nextAddress)return k.yield(c(b.arch_base+b.arch_search+a.toLowerCase()+"*"),2);d=k.yieldResult;g=null;e=[];try{g=JSON.parse(d)}catch(p){}if(g)for(m=0,q=$jscomp.makeIterator(g.response.docs),h=q.next();!h.done;h=q.next())f=h.value,e.push({title:(++m).toString()+"."+f.title,catalogue_url:b.cors_proxy+b.arch_base+b.arch_download+
f.identifier+"/"+f.identifier.slice(3)+".z80"});return k.return(new Promise(function(a){a(e)}))})};var g=!1;b.init=function(a,c,l,e){var d=$(a+" option").length;$(a).append($("<option></option>").text("Archive - Archive.org full catalogue"));$(a).change(function(){g=!1;switch($(a+" option:selected").index()-d){case 0:g=!0;$(c).empty();for(var b=65;90>=b;b++)$(c).append($("<option></option>").text(String.fromCharCode(b)));for(b=48;57>=b;b++)$(c).append($("<option></option>").text(String.fromCharCode(b)));
$(c).trigger("change")}});$(c).change(function(){g&&($(l).empty(),b.getIndex($(c+" option:selected").html()).then(function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=$("<option></option>");c.text(b.title);c.attr("href",b.catalogue_url);$(l).append(c)}$(l).trigger("change")}))});$(l).change(function(){if(g){$(e).empty();var a=$(l+" option:selected").attr("href"),b=a.slice(a.lastIndexOf("/")+1),c=$("<option></option>");c.text(b);c.attr("href",a);$(e).append(c);
$(e).trigger("change")}});0==d&&$(a).trigger("change")};return b};function DummyCat(){var a={},b=!1;a.init=function(a,g,d,k){var c=$(a+" option").length;$(a).append($("<option></option>").text("-"));$(a).change(function(){b=!1;switch($(a+" option:selected").index()-c){case 0:b=!0;$(g).empty();var d=$("<option></option>");d.text("-");d.attr("href","");$(g).append(d);setTimeout(function(){$(g).trigger("change")},0)}});$(g).change(function(){if(b){$(d).empty();var a=$("<option></option>");a.text("-");a.attr("href","");$(d).append(a);setTimeout(function(){$(d).trigger("change")},
0)}});$(d).change(function(){if(b){$(k).empty();var a=$("<option></option>");a.text("-");a.attr("href","");$(k).append(a);setTimeout(function(){$(k).trigger("change")},0)}});0==c&&$(a).trigger("change")};return a};var url_pars_list=[];$.urlPar=function(a,b){b||url_pars_list.includes(a)||url_pars_list.push(a);if(b){var c=new URL(document.URL);c.searchParams.set(a,b);history.pushState({id:"homepage"},document.title,document.URL=c.toString())}else return(new URL(document.URL)).searchParams.get(a)};
JSSpeccy.UI=function(a){function b(){f.isRunning?D.removeClass("start").addClass("stop"):D.removeClass("stop").addClass("start")}function c(a){H.toggleClass("enabled",a)}function g(){E.val(f.getModel().id)}function d(a){a?(z.attr("checked",!0),$(h).addClass("hard-edged-pixels")):(z.removeAttr("checked"),$(h).removeClass("hard-edged-pixels"))}function k(a){$(".panel",h).hide();$(".panel",h).filter(a).show();f.deactivateKeyboard()}function l(){$(".panel",h).hide();f.activateKeyboard()}function e(a,
b,c,d){var B=document.createElement("option");B.appendChild(document.createTextNode(c));B.value=b;c==d&&(B.selected=!0);document.getElementById(a).appendChild(B)}function m(a,b){document.getElementById(a).innerHTML="";e(a,38,"\u2191",b);e(a,40,"\u2193",b);e(a,37,"\u2190",b);e(a,39,"\u2192",b);e(a,32,"Space",b);e(a,13,"Enter",b);e(a,17,"Symbol Shift",b);for(r=48;58>r;r++)e(a,r,String.fromCharCode(r),b);for(r=65;91>r;r++)e(a,r,String.fromCharCode(r),b)}function q(b,c){a.debugPrint&&console.log(c+" "+
b);f.keyboard().registerKeyDown(b);setTimeout(function(){f.keyboard().registerKeyUp(b);$("#typer",h).val(1==c.length?c:"")},$.key_timeout)}$.key_timeout=50;var h=a.container;"string"===typeof h&&(h=document.getElementById(h));var f=a.controller;document.getElementsByTagName("body");$(h).addClass("jsspeccy");var v=$.urlPar("load");v&&(v=decodeURI(v).replace(a.corsProxy,""),a.debugPrint&&console.log("load url: ",v),f.stop(),f.setLoadUrlOnStart(a.corsProxy+v));var p=$(".toolbar",h),D=$("button.stop-start",
p);D.click(function(){f.isRunning?f.stop():f.start()});f.onStart.bind(b);f.onStop.bind(b);b();document.addEventListener("visibilitychange",function(){document.hidden&&f.isRunning&&f.stop()},!1);$("button.reset",p).click(function(){f.reset();f.isRunning||(f.setLoadUrlOnStart(""),f.start());$("#catalogue").prop("selectedIndex",0);$("#catalogue").trigger("change")});var x=!0;$("button.menu",p).click(function(){x?($("li",p).not(":first").hide(),$(".toolbar-div").width($(".toolbar-div").height())):($(".toolbar-div").width("100%"),
$("li",p).not(":first").show());x=!x});$("button.menu",p).trigger("click");var H=$("button.audio",p);H.click(function(){f.setAudioState(!f.getAudioState())});f.onChangeAudioState.bind(c);c(f.getAudioState());$("button.open",p).click(function(){f.stop();k(".open-file")});$("button.about",p).click(function(){f.stop();k(".about")});$("button.joystick_keys",p).click(function(){f.stop();k(".joystick_keys")});$("button.pokes",p).click(function(){f.stop();$("#error_text",u).text("");k(".pokes");var a=$(u.find("textarea")[0]),
b=a.val(),c=$("#index option:selected").text().toUpperCase().trim();c.indexOf(" 1")==c.length-2&&(c=c.slice(0,c.length-2));0<c.indexOf(".")&&0<parseInt(c.slice(0,c.indexOf(".")))&&(c=c.slice(c.indexOf(".")+1));var d=b.indexOf(c);0>d&&(0<c.indexOf(" 2")&&(c=c.replace(" 2"," II")),d=b.indexOf(c));0<=d&&(0<b.indexOf(" ",d+c.length+1)&&(b=b.slice(d+c.length,b.indexOf(" ",d+c.length+1)).trim(),u.find("input[type='text']").val(b)),a[0].setSelectionRange(d,d),a.blur(),a.focus(),a[0].setSelectionRange(d,
d+c.length))});$("button.run",p).click(function(){var b=$("#links").children(":selected").attr("href").replace(a.corsProxy,"");l();f.stop();f.setLoadUrlOnStart(a.corsProxy+b);f.start();$.urlPar("load",b);v=null});$("#links").change(function(){var b=$("#links").children(":selected").attr("href").replace(a.corsProxy,"");l();v||f.isRunning||f.setLoadUrlOnStart(a.corsProxy+b);C.val(b);$.urlPar("load",b)});$("#jsspeccy-fps",h).html('<div>Video FPS: <span class="fps">0.0</span></div><div>CPU FPS: <span class="cfps">0.0</span></div>');
var y=function(){var a=navigator.userAgent.toLowerCase(),b={},c=a.match(/(android)\s+([\d.]+)/),d=a.match(/(iphone\sos)\s([\d_]+)/),f=a.match(/(ipad).*os\s([\d_]+)/),e=a.match(/(web[o0]s)/),g=a.match(/(windows)\D+([\d.]+)/),h=a.match(/(linux)\s+([\d.]+)/);a=a.match(/\((\w+);/);c?(b.name="Android",b.version=c[2]||""):d?(b.name="iOS",b.version=d[2].replace(/_/g,".")||""):f?(b.name="iOS",b.version=f[2].replace(/_/g,".")||""):e?(b.name="webOS",b.version=""):g?(b.name="Windows",b.version=g[2]||""):h?(b.name=
"Linux",b.version=h[2]||""):(b.name=a?a[1]:"Not detected",b.version="");return b}(),R="Windows"==y.name||"on"===$.urlPar("is_windows"),S="Linux"==y.name||"on"===$.urlPar("is_linux"),t="webOS"==y.name||"on"===$.urlPar("is_smarttv"),F="Android"==y.name||"on"===$.urlPar("is_mobile");$("button.deviceinfo",p).click(function(){$(".panel.information #content").html("<br/>Device information<p>User agent: "+navigator.userAgent+'</p><p><div>Video FPS: <span class="fps">0.0</span></div><div>CPU FPS: <span class="cfps">0.0</span></div></p><p>Screen size: '+
window.screen.width+"x"+window.screen.height+"<br/>Device pixel ratio: "+window.devicePixelRatio+"</p><p>URL: "+document.URL+"</p><p>Platform: "+(t?"SmartTV":F?"Mobile":R?"Windows":S?"Linux":"Unknown")+"</p><p>OS: "+y.name+" "+y.version+"</p>");k(".information")});var G=!1,T=document.exitFullscreen||document.webkitExitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||function(){},A=document.documentElement,U=A.requestFullscreen||A.webkitRequestFullscreen||
A.mozRequestFullscreen||A.msRequestFullscreen||function(){};!t&&"on"!==$.urlPar("always_fullscreen")&&(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.webkitCancelFullScreen||document.mozFullscreenEnabled||document.msFullscreenEnabled)?$("button.fullscreen",p).click(function(){G?(T.call(document),G=!1):(U.call(A),G=!0,x&&$("button.menu",p).trigger("click"))}):$("button.fullscreen",p).hide();var E=$("select.select-model",p);$("select.select-model",p).hide();for(var I={},r=0;r<
JSSpeccy.Spectrum.MODELS.length;r++){var n=JSSpeccy.Spectrum.MODELS[r];I[n.id]=n;E.append($("<option></option>").text(n.name).attr({value:n.id}))}E.change(function(){var a=$(this).val();f.setModel(I[a])});g();f.onChangeModel.bind(g);var V=$("input.autoload-tapes");$("input.autoload-tapes").parent().hide();var z=$("input.checkerboard-filter");d(f.settings.checkerboardFilter.get());f.settings.checkerboardFilter.onChange.bind(d);z.change(function(){f.settings.checkerboardFilter.set(z.is(":checked"))});
z.attr("checked","on"===$.urlPar("hq2x"));$(".panel button.close",h).click(function(){l()});n=$(".panel.open-file",h);var J=n.find("input[type='file']");J.change(function(){l();f.stop();f.loadLocalFile(this.files[0],{autoload:V.is(":checked"),debugPrint:a.debugPrint});J.val("")});t&&"on"!==$.urlPar("load_file")&&$("#load_file",h).hide();t&&"on"!==$.urlPar("save_file")&&$("#save_file",h).hide();var C=n.find("input[type='url']");n.find("button.open-url").click(function(){var b=C.val();""!==b&&(l(),
f.stop(),f.setLoadUrlOnStart(a.corsProxy+b),f.start(),$.urlPar("load",b))});n.find("button.save-file").click(function(){var a=$("#index option:selected").text();if(0==a.length||"-"==a)a="snapshot_"+(new Date(Date.now())).toISOString().replace(/[:\.\-TZ]+/g,"_");""!==a&&(f.stop(),f.saveZ80Snapshot(a.replace(/[\s]+/g,"_")+".z80"),l())});var u=$(".panel.pokes",h);u.find("button.apply_pokes").click(function(){var b=u.find("input[type='text']").val(),c=!0;if(""!==b){b=$jscomp.makeIterator(b.split(":"));
for(var d=b.next();!d.done;d=b.next()){var e=$jscomp.makeIterator(d.value.split(",").map(Number));d=e.next().value;e=e.next().value;a.debugPrint&&console.log("Poke ",d," ",e);if(16384<=d&&65536>d&&0<=e&&256>e)f.poke(d,e);else{$("#error_text",u).text("Addresses or values are wrong");c=!1;break}}}else $("#error_text",u).text("Pokes string is empty"),c=!1;c&&l()});n=new URL(document.URL);n=n.protocol+"//"+(0<n.host.length?n.host+"/":"")+n.pathname.substring(0,n.pathname.lastIndexOf("/"));t?C.val("file://usb:0/"):
C.val(n.replace(a.corsProxy,""));(function(a,b){var c=new XMLHttpRequest;c.addEventListener("load",function(a){b(c.response)});c.open("GET",a);c.send()})("zx_spectrum_pokes.txt",function(a){u.find("textarea").val(a)});$.setJoystick=function(a){var b=a.split(",");up=b[0];down=b[1];left=b[2];right=b[3];fire=b[4];action=b[5];m("select_key_up",up);m("select_key_down",down);m("select_key_left",left);m("select_key_right",right);m("select_key_fire",fire);m("select_key_action",action);t&&f.setKeymap(a)};
$.setJoystick(document.getElementById("selcontrol").value);$.prev_keyupdown_time=performance.now();$.padTouch=function(a,b){a=document.getElementById(a);var c=a.options[a.selectedIndex];setTimeout(function(){f.keyboard().registerKeyDown(c.value)},Math.max($.key_timeout-(performance.now()-$.prev_keyupdown_time),0));$.prev_keyupdown_time=performance.now()};$.padUntouch=function(a,b){a=document.getElementById(a);var c=a.options[a.selectedIndex];setTimeout(function(){f.keyboard().registerKeyUp(c.value)},
Math.max($.key_timeout-(performance.now()-$.prev_keyupdown_time),0));$.prev_keyupdown_time=performance.now()};F||"on"===$.urlPar("padblock")||$(".padblock",h).hide();var K=document.onkeypress,L=!1;$("#typer",h).click(function(){f.keyboard().active?(a.debugPrint&&console.log("focus in on-screen keyboard"),K=document.onkeypress,document.onkeypress=function(){return!0},L=$(".padblock",h).is(":visible"),$(".padblock",h).hide(),f.keyboard().active=!1,$("#typer",h).focus()):$("#typer",h).blur()});var w=
229;$("#typer",h).keydown(function(a){w=a.keyCode;229!==w&&q(w,a.key)});$("#typer",h).on("input",function(a){229===w?(w=a.target.value.toUpperCase().charCodeAt(a.target.value.length-1),q(w,a.target.value)):w=229});$("#typer",h).focusout(function(){a.debugPrint&&console.log("focus out on-screen keyboard");$("#typer",h).val("");document.onkeypress=K;L&&$(".padblock",h).show();f.keyboard().active=!0});t||F||"on"===$.urlPar("typer")||$("#typer-div",h).hide();t&&(document.addEventListener("keyboardStateChange",
function(){event.detail.visibility||$("#typer",h).blur()}),document.addEventListener("keydown",function(a){console.log(a.key+" "+a.keyCode);a.keyCode==f.keyboard().TV_Blue&&$("#typer",h).click();a.keyCode==f.keyboard().TV_Back&&$("#typer",h).blur()}));setInterval(function(){$(".fps").text(f.getFps().toFixed(1));$(".cfps").text(f.getCfps().toFixed(1))},1E3);history.pushState(null,null,location.href);window.onpopstate=function(){history.go(1);$("#typer",h).blur()};a.debugPrint?console.log("URL keys: ",
url_pars_list):$(document).bind("contextmenu",function(a){0<$(h).find($(a.target)).length&&$(a.target).is("canvas")&&(console.log($(h).find($(a.target))),a.preventDefault())});t&&setTimeout(function(){f.start()},0);n=["#catalogue","#letter","#index","#links"];var M;(M=new DummyCat).init.apply(M,$jscomp.arrayFromIterable(n));var N;(N=new ZxCzCat(a.cors_proxy)).init.apply(N,$jscomp.arrayFromIterable(n));var O;(O=new Rgb2019Cat(a.cors_proxy)).init.apply(O,$jscomp.arrayFromIterable(n));var P;(P=new WoSCat(a.cors_proxy)).init.apply(P,
$jscomp.arrayFromIterable(n));var Q;(Q=new ArchCat(a.cors_proxy)).init.apply(Q,$jscomp.arrayFromIterable(n));return{}};
