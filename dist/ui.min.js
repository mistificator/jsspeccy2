var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";
var $jscomp$lookupPolyfilledValue=function(a,b){var d=$jscomp.propertyToPolyfillSymbol[b];if(null==d)return a[b];d=a[d];return void 0!==d?d:a[b]};$jscomp.polyfill=function(a,b,d,e){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,d,e):$jscomp.polyfillUnisolated(a,b,d,e))};
$jscomp.polyfillUnisolated=function(a,b,d,e){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var c=a[e];c in d||(d[c]={});d=d[c]}a=a[a.length-1];e=d[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,d,e){var c=a.split(".");a=1===c.length;e=c[0];e=!a&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var k=0;k<c.length-1;k++){var f=c[k];f in e||(e[f]={});e=e[f]}c=c[c.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?e[c]:null;b=b(d);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:b}):b!==d&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):$jscomp.POLYFILL_PREFIX+c,c=$jscomp.propertyToPolyfillSymbol[c],
$jscomp.defineProperty(e,c,{configurable:!0,writable:!0,value:b})))};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function d(a){return a instanceof c?a:new c(function(f,b){f(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var f=this;this.asyncExecuteFunction(function(){f.executeBatch_()})}this.batch_.push(a)};var e=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){e(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(p){this.asyncThrow_(p)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var c=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(n){b.reject(n)}};c.prototype.createResolveAndReject_=function(){function a(a){return function(f){c||(c=!0,a.call(b,f))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};c.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof c)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};c.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(n){this.reject_(n);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};c.prototype.reject_=function(a){this.settle_(2,a)};c.prototype.fulfill_=function(a){this.settle_(1,a)};c.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};c.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)k.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var k=new b;c.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};c.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(p){c.reject(p)}};c.prototype.then=function(a,b){function f(a,b){return"function"==typeof a?function(b){try{p(a(b))}catch(z){g(z)}}:b}var p,g,d=new c(function(a,b){p=a;g=b});this.callWhenSettled_(f(a,p),f(b,g));return d};
c.prototype.catch=function(a){return this.then(void 0,a)};c.prototype.callWhenSettled_=function(a,b){function c(){switch(f.state_){case 1:a(f.result_);break;case 2:b(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?k.asyncExecute(c):this.onSettledCallbacks_.push(c)};c.resolve=d;c.reject=function(a){return new c(function(b,c){c(a)})};c.race=function(a){return new c(function(b,c){for(var f=$jscomp.makeIterator(a),g=f.next();!g.done;g=f.next())d(g.value).callWhenSettled_(b,
c)})};c.all=function(a){var b=$jscomp.makeIterator(a),f=b.next();return f.done?d([]):new c(function(a,c){function g(b){return function(c){e[b]=c;p--;0==p&&a(e)}}var e=[],p=0;do e.push(void 0),p++,d(f.value).callWhenSettled_(g(e.length-1),c),f=b.next();while(!f.done)})};return c},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var d=0,e=function(a){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(a||"")+"_"+d++,a)};return e},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),d=0;d<b.length;d++){var e=$jscomp.global[b[d]];"function"===typeof e&&"function"!=typeof e.prototype[a]&&$jscomp.defineProperty(e.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(d){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var d=a.next();$jscomp.generator.ensureIteratorResultIsObject_(d);if(d.done)this.yieldResult=d.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(d.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,d){d?this.finallyContexts_[d]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,d){try{var e=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(e);if(!e.done)return this.context_.stop_(),e;var c=e.value}catch(k){return this.context_.yieldAllIterator_=null,this.context_.throw_(k),this.nextStep_()}this.context_.yieldAllIterator_=null;d.call(this.context_,c);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function d(b){return a.throw(b)}return new Promise(function(e,c){function k(a){a.done?e(a.value):Promise.resolve(a.value).then(b,d).then(k,c)}k(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("Object.is",function(a){return a?a:function(a,d){return a===d?0!==a||1/a===1/d:a!==a&&d!==d}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,d){var b=this;b instanceof String&&(b=String(b));var c=b.length;d=d||0;for(0>d&&(d=Math.max(d+c,0));d<c;d++){var k=b[d];if(k===a||Object.is(k,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,d){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,d||0)}},"es6","es3");
$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var e=a.length,c=0;c<e;c++){var k=a[c];if(b.call(d,k,c,a))return{i:c,v:k}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
function WoS(){var a={cors_proxy:"https://non-cors.herokuapp.com/",wos_base:"https://www.worldofspectrum.org",wos_search:"/infoseekid.cgi%3Fid=",wos_index:"/games/",wos_top100:"/bestgames.html"},b=function(a){return new Promise(function(b,d){var c=new XMLHttpRequest;c.open("GET",a);c.onload=function(){200==c.status?b(c.responseText):d(c.responseStatus)};c.onerror=function(){d(c.responseStatus)};c.send()})};a.getIndex=function(d){var c,e,f,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){switch(n.nextAddress){case 1:return"#"==
d&&(d="1"),"-"!=d?n.yield(b(a.cors_proxy+a.wos_base+a.wos_index+d.toLowerCase()+".html"),5):n.yield(b(a.cors_proxy+a.wos_base+a.wos_top100),4);case 4:c=n.yieldResult;n.jumpTo(3);break;case 5:c=n.yieldResult;case 3:return e=c,f=$.parseHTML(e),l=[],"-"!=d?$("pre",f).each(function(b,c){b=0;c=$jscomp.makeIterator($("a",c));for(var g=c.next();!g.done;g=c.next())g=g.value,l.push({title:(++b).toString()+"."+$(g).text(),catalogue_url:a.cors_proxy+a.wos_base+$(g).attr("href").split("?").join("%3F")})}):$("table",
f).each(function(b,c){if($("tr:contains('Score')",c).length){b=0;c=$jscomp.makeIterator($("a",c));for(var g=c.next();!g.done;g=c.next())g=g.value,l.push({title:(++b).toString()+"."+$(g).text(),catalogue_url:a.cors_proxy+a.wos_base+$(g).attr("href").split("?").join("%3F")})}}),n.return(new Promise(function(a){a(l)}))}})};a.getLinks=function(d){var c,e,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){if(1==k.nextAddress)return k.yield(b(d),2);c=k.yieldResult;e=$.parseHTML(c);f=[];$("table",
e).each(function(b,c){c=$("tr:contains('Filename')",c);if(c.length){b=$("td:contains('Filename')",c).index();c=$jscomp.makeIterator(c.siblings());for(var g=c.next();!g.done;g=c.next())if(g=$("a",$("td:eq("+b+")",g.value)).attr("href")){var d=g.split("."),e=d.pop().toUpperCase();"ZIP"==e&&(e=d.pop().toUpperCase());if("TZX"==e||"TAP"==e||"Z80"==e||"SNA"==e)"TAP"==e?f.unshift(a.cors_proxy+a.wos_base+g):f.push(a.cors_proxy+a.wos_base+g)}return!1}});return k.return(new Promise(function(a){a(f)}))})};var d=
!1;a.init=function(b,c,k,f){var e=$(b+" option").length;$(b).append($("<option></option>").text("TOP-100 - WorldOfSpectrum.org TOP-100"));$(b).append($("<option></option>").text("WoS All - WorldOfSpectrum.org full catalogue"));$(b).change(function(){d=!1;switch($(b+" option:selected").index()-e){case 0:d=!0;$(c).empty();$(c).append($("<option></option>").text("-"));$(c).trigger("change");break;case 1:d=!0;$(c).empty();for(var a=65;90>=a;a++)$(c).append($("<option></option>").text(String.fromCharCode(a)));
$(c).append($("<option></option>").text("#"));$(c).trigger("change")}});$(c).change(function(){d&&($(k).empty(),a.getIndex($(c+" option:selected").html()).then(function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=$("<option></option>");c.text(b.title);c.attr("href",b.catalogue_url);$(k).append(c)}$(k).trigger("change")}))});$(k).change(function(){d&&($(f).empty(),a.getLinks($(k+" option:selected").attr("href")).then(function(a){for(var b=0;b<a.length;b++){var c=
$("<option></option>");c.text((b+1).toString()+"."+a[b].slice(a[b].lastIndexOf("/")+1));c.attr("href",a[b]);$(f).append(c)}$(f).trigger("change")}))});0==e&&$(b).trigger("change")};return a};function ZxCz(){var a={},b=function(a){return a.split("?").join("%3F").split("&").join("%26")};a.cors_proxy="https://non-cors.herokuapp.com/";a.zxcz_base="https://www.zx-spectrum.cz";a.zxcz_index=b("/index.php?cat1=3&cat2=3&games_page=");a.zxcz_download="/data/games/files/";var d=function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a);d.onload=function(){200==d.status?b(d.responseText):c(d.responseStatus)};d.onerror=function(){c(d.responseStatus)};d.send()})};a.getIndex=
function(){var c,e,f,l,n,p,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==h.nextAddress)return c=a.cors_proxy+a.zxcz_base+a.zxcz_index+"1",h.yield(d(c),2);e=h.yieldResult;f=$.parseHTML(e);l=[];l.push({page:"1",catalogue_url:c});n=$jscomp.makeIterator($("a",$(".paging",f).first()));for(p=n.next();!p.done;p=n.next())g=p.value,l.push({page:$(g).text().trim(),catalogue_url:a.cors_proxy+a.zxcz_base+"/"+b($(g).attr("href"))});return h.return(new Promise(function(a){a(l)}))})};a.getLinks=
function(b){var c,e,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress)return f.yield(d(b),2);c=f.yieldResult;e=$.parseHTML(c);l=[];$("tr",$("table.listbox",e)).each(function(b,c){0<b&&(b=$("a",$("td:eq(0)",c)).text().replace(/\s\(\d+\)$/,""),c=$("a:first",$("td:eq(6)",c)).attr("href"),b&&c&&(c=a.cors_proxy+a.zxcz_base+a.zxcz_download+c.slice(c.lastIndexOf("=")+1),l.push({title:b,tape_url:c})))});return f.return(new Promise(function(a){a(l)}))})};var e=!1;a.init=
function(b,d,f,l){var c=$(b+" option").length;$(b).append($("<option></option>").text("ZXCZ - ZX-Spectrum.CZ full catalogue"));$(b).change(function(){e=!1;switch($(b+" option:selected").index()-c){case 0:e=!0,$(d).empty(),a.getIndex().then(function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=$("<option></option>");c.text(b.page);c.attr("href",b.catalogue_url);$(d).append(c)}$(d).trigger("change")})}});$(d).change(function(){e&&($(f).empty(),a.getLinks($(d+" option:selected").attr("href")).then(function(a){a=
$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=$("<option></option>");c.text(b.title);c.attr("href",b.tape_url);$(f).append(c)}$(f).trigger("change")}))});$(f).change(function(){if(e){$(l).empty();var a=$(f+" option:selected").attr("href"),b=$("<option></option>");b.text(a.slice(a.lastIndexOf("/")+1));b.attr("href",a);$(l).append(b);$(l).trigger("change")}});0==c&&$(b).trigger("change")};return a};function Rgb2019(){var a={cors_proxy:"https://non-cors.herokuapp.com/",rgb2019_base:"https://rgb.yandex/"},b=function(a){return new Promise(function(b,d){var c=new XMLHttpRequest;c.open("GET",a);c.onload=function(){200==c.status?b(c.responseText):d(c.responseStatus)};c.onerror=function(){d(c.responseStatus)};c.send()})};a.getLinks=function(){var d,c,k;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==e.nextAddress)return e.yield(b(a.cors_proxy+a.rgb2019_base),2);d=e.yieldResult;
c=$.parseHTML(d);k=[];$("div.game__card",c).each(function(b,c){b=b+1+"."+$("h4",c).text().trim();c=$("a:first",c).attr("href");b&&c&&(c=a.cors_proxy+a.rgb2019_base+c,k.push({title:b,tape_url:c}))});return e.return(new Promise(function(a){a(k)}))})};var d=!1;a.init=function(b,c,k,f){var e=$(b+" option").length;$(b).append($("<option></option>").text("RGB - Yandex Retro Games Battle 2019"));$(b).change(function(){d=!1;switch($(b+" option:selected").index()-e){case 0:d=!0;$(c).empty();var f=$("<option></option>");
f.text("-");$(c).append(f);$(k).empty();a.getLinks().then(function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=$("<option></option>");c.text(b.title);c.attr("href",b.tape_url);$(k).append(c)}$(k).trigger("change")})}});$(k).change(function(){if(d){$(f).empty();var a=$(k+" option:selected").attr("href"),b=$("<option></option>");b.text(a.slice(a.lastIndexOf("/")+1));b.attr("href",a);$(f).append(b);$(f).trigger("change")}});0==e&&$(b).trigger("change")};return a}
;function Arch(){var a={cors_proxy:"https://non-cors.herokuapp.com/",arch_base:"https://archive.org",arch_search:"/advancedsearch.php?fl%5B%5D=identifier&fl%5B%5D=title&sort%5B%5D=titleSorter+asc&rows=100000&page=1&output=json&q=mediatype%3Asoftware+identifier%3Azx_",arch_download:"/download/"},b=function(a){return new Promise(function(b,d){var c=new XMLHttpRequest;c.open("GET",a);c.onload=function(){200==c.status?b(c.responseText):d(c.responseStatus)};c.onerror=function(){d(c.responseStatus)};c.send()})};
a.getIndex=function(d){var c,e,f,l,n,p,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==h.nextAddress)return h.yield(b(a.arch_base+a.arch_search+d.toLowerCase()+"*"),2);c=h.yieldResult;e=null;f=[];try{e=JSON.parse(c)}catch(u){}if(e)for(l=0,n=$jscomp.makeIterator(e.response.docs),p=n.next();!p.done;p=n.next())g=p.value,f.push({title:(++l).toString()+"."+g.title,catalogue_url:a.cors_proxy+a.arch_base+a.arch_download+g.identifier+"/"+g.identifier.slice(3)+".z80"});return h.return(new Promise(function(a){a(f)}))})};
var d=!1;a.init=function(b,c,k,f){var e=$(b+" option").length;$(b).append($("<option></option>").text("Archive - Archive.org full catalogue"));$(b).change(function(){d=!1;switch($(b+" option:selected").index()-e){case 0:d=!0;$(c).empty();for(var a=65;90>=a;a++)$(c).append($("<option></option>").text(String.fromCharCode(a)));for(a=48;57>=a;a++)$(c).append($("<option></option>").text(String.fromCharCode(a)));$(c).trigger("change")}});$(c).change(function(){d&&($(k).empty(),a.getIndex($(c+" option:selected").html()).then(function(a){a=
$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;var c=$("<option></option>");c.text(b.title);c.attr("href",b.catalogue_url);$(k).append(c)}$(k).trigger("change")}))});$(k).change(function(){if(d){$(f).empty();var a=$(k+" option:selected").attr("href"),b=a.slice(a.lastIndexOf("/")+1),c=$("<option></option>");c.text(b);c.attr("href",a);$(f).append(c);$(f).trigger("change")}});0==e&&$(b).trigger("change")};return a};var url_pars_list=[];$.urlPar=function(a){url_pars_list.includes(a)||url_pars_list.push(a);return(new URL(document.URL)).searchParams.get(a)};
JSSpeccy.UI=function(a){function b(){h.isRunning?B.removeClass("start").addClass("stop"):B.removeClass("stop").addClass("start")}function d(a){z.toggleClass("enabled",a)}function e(){C.val(h.getModel().id)}function c(a){a?(w.attr("checked",!0),$(g).addClass("hard-edged-pixels")):(w.removeAttr("checked"),$(g).removeClass("hard-edged-pixels"))}function k(a){$(".panel",g).hide();$(".panel",g).filter(a).show();h.deactivateKeyboard()}function f(){$(".panel",g).hide();h.activateKeyboard()}function l(a,
b,c,d){var e=document.createElement("option");e.appendChild(document.createTextNode(c));e.value=b;c==d&&(e.selected=!0);document.getElementById(a).appendChild(e)}function n(a,b){document.getElementById(a).innerHTML="";l(a,38,"\u2191",b);l(a,40,"\u2193",b);l(a,37,"\u2190",b);l(a,39,"\u2192",b);l(a,32,"Space",b);l(a,13,"Enter",b);l(a,17,"Symbol Shift",b);for(q=48;58>q;q++)l(a,q,String.fromCharCode(q),b);for(q=65;91>q;q++)l(a,q,String.fromCharCode(q),b)}function p(b,c){a.debugPrint&&console.log(c+" "+
b);h.keyboard().registerKeyDown(b);setTimeout(function(){h.keyboard().registerKeyUp(b);$("#typer",g).val(1==c.length?c:"")},$.key_timeout)}$.key_timeout=50;var g=a.container;"string"===typeof g&&(g=document.getElementById(g));var h=a.controller;document.getElementsByTagName("body");$(g).addClass("jsspeccy");var u=$.urlPar("load");u&&(u=decodeURI(u),a.debugPrint&&console.log("load url: ",u),h.stop(),h.setLoadUrlOnStart(u));var m=$(".toolbar",g),B=$("button.stop-start",m);B.click(function(){h.isRunning?
h.stop():h.start()});h.onStart.bind(b);h.onStop.bind(b);b();document.addEventListener("visibilitychange",function(){document.hidden&&h.isRunning&&h.stop()},!1);$("button.reset",m).click(function(){h.reset();h.isRunning||(h.setLoadUrlOnStart(""),h.start())});var z=$("button.audio",m);z.click(function(){h.setAudioState(!h.getAudioState())});h.onChangeAudioState.bind(d);d(h.getAudioState());$("button.open",m).click(function(){h.stop();k(".open-file")});$("button.about",m).click(function(){h.stop();k(".about")});
$("button.joystick_keys",m).click(function(){h.stop();k(".joystick_keys")});$("button.pokes",m).click(function(){h.stop();$("#error_text",r).text("");k(".pokes");var a=$(r.find("textarea")[0]),b=a.val(),c=$("#index option:selected").text().toUpperCase().trim();c.indexOf(" 1")==c.length-2&&(c=c.slice(0,c.length-2));0<c.indexOf(".")&&0<parseInt(c.slice(0,c.indexOf(".")))&&(c=c.slice(c.indexOf(".")+1));var d=b.indexOf(c);0>d&&(0<c.indexOf(" 2")&&(c=c.replace(" 2"," II")),d=b.indexOf(c));0<=d&&(0<b.indexOf(" ",
d+c.length+1)&&(b=b.slice(d+c.length,b.indexOf(" ",d+c.length+1)).trim(),r.find("input[type='text']").val(b)),a[0].setSelectionRange(d,d),a.blur(),a.focus(),a[0].setSelectionRange(d,d+c.length))});$("button.run",m).click(function(){f();h.stop();h.setLoadUrlOnStart($("#links").children(":selected").attr("href"));h.start()});$("#links").change(function(){f();h.isRunning||u||h.setLoadUrlOnStart($("#links").children(":selected").attr("href"));A.val($("#links").children(":selected").attr("href"))});$("#jsspeccy-fps",
g).html('<div>Video FPS: <span class="fps">0.0</span></div><div>CPU FPS: <span class="cfps">0.0</span></div>');var x=function(){var a=navigator.userAgent.toLowerCase(),b={},c=a.match(/(android)\s+([\d.]+)/),d=a.match(/(iphone\sos)\s([\d_]+)/),e=a.match(/(ipad).*os\s([\d_]+)/),g=a.match(/(web[o0]s)/),f=a.match(/(windows)\D+([\d.]+)/),h=a.match(/(linux)\s+([\d.]+)/);a=a.match(/\((\w+);/);c?(b.name="Android",b.version=c[2]||""):d?(b.name="iOS",b.version=d[2].replace(/_/g,".")||""):e?(b.name="iOS",b.version=
e[2].replace(/_/g,".")||""):g?(b.name="webOS",b.version=""):f?(b.name="Windows",b.version=f[2]||""):h?(b.name="Linux",b.version=h[2]||""):(b.name=a?a[1]:"Not detected",b.version="");return b}(),J="Windows"==x.name||"on"===$.urlPar("is_windows"),K="Linux"==x.name||"on"===$.urlPar("is_linux"),t="webOS"==x.name||"on"===$.urlPar("is_smarttv"),D="Android"==x.name||"on"===$.urlPar("is_mobile");$("button.deviceinfo",m).click(function(){$(".panel.information #content").html("<br/>Device information<p>User agent: "+
navigator.userAgent+'</p><p><div>Video FPS: <span class="fps">0.0</span></div><div>CPU FPS: <span class="cfps">0.0</span></div></p><p>Screen size: '+window.screen.width+"x"+window.screen.height+"<br/>Device pixel ratio: "+window.devicePixelRatio+"</p><p>URL: "+document.URL+"</p><p>Platform: "+(t?"SmartTV":D?"Mobile":J?"Windows":K?"Linux":"Unknown")+"</p><p>OS: "+x.name+" "+x.version+"</p>");k(".information")});var E=!1,L=document.exitFullscreen||document.webkitExitFullscreen||document.webkitCancelFullScreen||
document.mozCancelFullScreen||document.msExitFullscreen||function(){},y=document.documentElement,M=y.requestFullscreen||y.webkitRequestFullscreen||y.mozRequestFullscreen||y.msRequestFullscreen||function(){};!t&&"on"!==$.urlPar("always_fullscreen")&&(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.webkitCancelFullScreen||document.mozFullscreenEnabled||document.msFullscreenEnabled)?$("button.fullscreen",m).click(function(){E?(L.call(document),E=!1):(M.call(y),E=!0)}):$("button.fullscreen",
m).hide();var C=$("select.select-model",m);$("select.select-model",m).hide();for(var F={},q=0;q<JSSpeccy.Spectrum.MODELS.length;q++)m=JSSpeccy.Spectrum.MODELS[q],F[m.id]=m,C.append($("<option></option>").text(m.name).attr({value:m.id}));C.change(function(){var a=$(this).val();h.setModel(F[a])});e();h.onChangeModel.bind(e);var N=$("input.autoload-tapes");$("input.autoload-tapes").parent().hide();var w=$("input.checkerboard-filter");c(h.settings.checkerboardFilter.get());h.settings.checkerboardFilter.onChange.bind(c);
w.change(function(){h.settings.checkerboardFilter.set(w.is(":checked"))});""===($.urlPar("hq2x")||"")?w.parent().hide():w.attr("checked","on"===$.urlPar("hq2x"));$(".panel button.close",g).click(function(){f()});m=$(".panel.open-file",g);var G=m.find("input[type='file']");G.change(function(){f();h.loadLocalFile(this.files[0],{autoload:N.is(":checked"),debugPrint:a.debugPrint});G.val("")});t&&"on"!==$.urlPar("load_file")&&$("#load_file",g).hide();var A=m.find("input[type='url']");m.find("button.open-url").click(function(){""!==
A.val()&&(f(),h.stop(),h.setLoadUrlOnStart($("#links").children(":selected").attr("href")),h.start())});var r=$(".panel.pokes",g);r.find("button.apply_pokes").click(function(){var b=r.find("input[type='text']").val(),c=!0;if(""!==b){b=$jscomp.makeIterator(b.split(":"));for(var d=b.next();!d.done;d=b.next()){var e=$jscomp.makeIterator(d.value.split(",").map(Number));d=e.next().value;e=e.next().value;a.debugPrint&&console.log("Poke ",d," ",e);if(16384<=d&&65536>d&&0<=e&&256>e)h.poke(d,e);else{$("#error_text",
r).text("Addresses or values are wrong");c=!1;break}}}else $("#error_text",r).text("Pokes string is empty"),c=!1;c&&f()});m=new URL(document.URL);m=m.protocol+"//"+(0<m.host.length?m.host+"/":"")+m.pathname.substring(0,m.pathname.lastIndexOf("/"));t?A.val("file://usb:0/"):A.val(m);(function(a,b){var c=new XMLHttpRequest;c.addEventListener("load",function(a){b(c.response)});c.open("GET",a);c.send()})("zx_spectrum_pokes.txt",function(a){r.find("textarea").val(a)});$.setJoystick=function(a){var b=a.split(",");
up=b[0];down=b[1];left=b[2];right=b[3];fire=b[4];action=b[5];n("select_key_up",up);n("select_key_down",down);n("select_key_left",left);n("select_key_right",right);n("select_key_fire",fire);n("select_key_action",action);t&&h.setKeymap(a)};$.setJoystick(document.getElementById("selcontrol").value);$.prev_keyupdown_time=performance.now();$.padTouch=function(a,b){a=document.getElementById(a);var c=a.options[a.selectedIndex];setTimeout(function(){h.keyboard().registerKeyDown(c.value)},Math.max($.key_timeout-
(performance.now()-$.prev_keyupdown_time),0));$.prev_keyupdown_time=performance.now()};$.padUntouch=function(a,b){a=document.getElementById(a);var c=a.options[a.selectedIndex];setTimeout(function(){h.keyboard().registerKeyUp(c.value)},Math.max($.key_timeout-(performance.now()-$.prev_keyupdown_time),0));$.prev_keyupdown_time=performance.now()};D||"on"===$.urlPar("padblock")||$(".padblock",g).hide();var H=document.onkeypress,I=!1;$("#typer",g).click(function(){h.keyboard().active?(a.debugPrint&&console.log("focus in on-screen keyboard"),
H=document.onkeypress,document.onkeypress=function(){return!0},I=$(".padblock",g).is(":visible"),$(".padblock",g).hide(),h.keyboard().active=!1,$("#typer",g).focus()):$("#typer",g).blur()});var v=229;$("#typer",g).keydown(function(a){v=a.keyCode;229!==v&&p(v,a.key)});$("#typer",g).on("input",function(a){229===v?(v=a.target.value.toUpperCase().charCodeAt(a.target.value.length-1),p(v,a.target.value)):v=229});$("#typer",g).focusout(function(){a.debugPrint&&console.log("focus out on-screen keyboard");
$("#typer",g).val("");document.onkeypress=H;I&&$(".padblock",g).show();h.keyboard().active=!0});t||D||"on"===$.urlPar("typer")||$("#typer-div",g).hide();t&&(document.addEventListener("keyboardStateChange",function(){event.detail.visibility||$("#typer",g).blur()}),document.addEventListener("keydown",function(a){console.log(a.key+" "+a.keyCode);a.keyCode==h.keyboard().TV_Blue&&$("#typer",g).click();a.keyCode==h.keyboard().TV_Back&&$("#typer",g).blur()}));setInterval(function(){$(".fps").text(h.getFps().toFixed(1));
$(".cfps").text(h.getCfps().toFixed(1))},1E3);history.pushState(null,null,location.href);window.onpopstate=function(){history.go(1);$("#typer",g).blur()};a.debugPrint?console.log("URL keys: ",url_pars_list):$(document).bind("contextmenu",function(a){0<$(g).find($(a.target)).length&&$(a.target).is("canvas")&&(console.log($(g).find($(a.target))),a.preventDefault())});t&&setTimeout(function(){h.start()},0);return{}};
