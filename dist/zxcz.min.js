function ZxCz(){var t={},e=function(t){return t.split("?").join("%3F").split("&").join("%26")};t.cors_proxy="https://non-cors.herokuapp.com/",t.zxcz_base="https://www.zx-spectrum.cz",t.zxcz_index=e("/index.php?cat1=3&cat2=3&games_page="),t.zxcz_download="/data/games/files/";var n=function(t){return new Promise((e,n)=>{const a=new XMLHttpRequest;a.open("GET",t),a.onload=function(){200==a.status?e(a.responseText):n(a.responseStatus)},a.onerror=function(){n(a.responseStatus)},a.send()})};t.getIndex=async function(){var a=t.cors_proxy+t.zxcz_base+t.zxcz_index+"1",o=await n(a),r=$.parseHTML(o),i=[];return i.push({page:"1",catalogue_url:a}),$(".paging",r).each((function(n,a){for(var o of $("a",a))i.push({page:$(o).text().trim(),catalogue_url:t.cors_proxy+t.zxcz_base+"/"+e($(o).attr("href"))});return!1})),new Promise(t=>{t(i)})},t.getLinks=async function(e){var a=await n(e),o=$.parseHTML(a),r=[];return $("tr",$("table.listbox",o)).each((function(e,n){if(e>0){var a=$("a",$("td:eq(0)",n)).text().replace(/\s\(\d+\)$/,""),o=$("a:first",$("td:eq(6)",n)).attr("href");a&&o&&(o=t.cors_proxy+t.zxcz_base+t.zxcz_download+o.slice(o.lastIndexOf("=")+1),r.push({title:a,tape_url:o}))}})),new Promise(t=>{t(r)})};var a=!1;return t.init=function(e,n,o,r){var i=$(e+" option").length;$(e).append($("<option></option>").text("ZXCZ - ZX-Spectrum.CZ full catalogue")),$(e).change((function(){switch(a=!1,$(e+" option:selected").index()-i){case 0:a=!0,$(n).empty(),t.getIndex().then((function(t){for(var e of t){var a=$("<option></option>");a.text(e.page),a.attr("href",e.catalogue_url),$(n).append(a)}$(n).trigger("change")}))}})),$(n).change((function(){a&&($(o).empty(),t.getLinks($(n+" option:selected").attr("href")).then((function(t){for(var e of t){var n=$("<option></option>");n.text(e.title),n.attr("href",e.tape_url),$(o).append(n)}$(o).trigger("change")})))})),$(o).change((function(){if(a){$(r).empty();var t=$(o+" option:selected").attr("href"),e=$("<option></option>");e.text(t.slice(t.lastIndexOf("/")+1)),e.attr("href",t),$(r).append(e)}})),$(e).trigger("change")},t}
